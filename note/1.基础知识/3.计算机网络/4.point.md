# Network

## 三次握手和四次挥手

答：
三次握手：

1. 由C（客户端）向S（服务端）发送一个SYN报文来请求建立连接，并确定自己的初始化序列号 ISN为x。SYN = 1（SYN为1的报文不能携带数据），seq = x。
2. S收到SYN后会为连接分配内存并回复一个ACK报文，并确定自己的初始化序列号 ISN为y。SYN = 1，ACK=1，seq = y，ack = x+1。
3. C收到ACK后为连接分配内存并再回复一个ACK，表示C建立好连接，S收到这个报文后连接建立成功。ACK = 1，seq = x+1，ack = y+1。

三次握手主要是保证建立连接的两端都收到一次对方的响应报文，知道对方准备好建立连接了。

四次挥手：

1. 由C向S发送一个FIN报文来请求断开连接。这时C就不能够再发送数据了。FIN = 1，seq = u。
2. S收到后会立即返回一个ACK，并继续发送自己没发送完的数据。ACK=1，seq = v，ack = u+1。
3. 当S处理完数据准备断开连接时，会向C发送一个FIN报文请求断开连接，然后启动一个计时器计时2MSL，当计时器结束还没收到ACK时会重复进行第三次挥手。FIN=1，ACK=1， seq = w，ack = u+1。
4. C收到后会发送ACK给S，然后断开连接。ACK = 1，seq = u+1，ack = w+1。

## Session、Cookie和Token

答：
Cookie是由浏览器存储的一系列Key-Value数据，会随请求发送到服务端程序中供使用。
Session是服务端针对每一个客户端存储到一系列Key-Value数据，依赖Cookie实现。实际上是通过Cookie中的session_id在一个map中找到的Session数据。相对Cookie比较安全，但是需要消耗服务端内存，并且需要考虑分布式系统中的一致性问题。
Token是指如果只考虑服务鉴权方面，服务端在客户端登陆后可以返回给客户端一些用户数据和这一系列数据加密计算之后的结果，这些数据一起作为Token。后续客户端请求服务端只需要带上Token，服务端收到请求后会解析数据，并再次进行加密计算。比对加密结果即可验证Token有效性。
