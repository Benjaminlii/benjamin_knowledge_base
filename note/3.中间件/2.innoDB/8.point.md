# mySQL - InnoDB

## B+树和B树的区别是什么？

答：
B树和B+树都是多叉的平衡查找树。
一个M阶B树每个节点拥有M-1个数据域，M个指针域。每两个指针域被一个数据域分隔开，指针域包含的数据分别大于小于中间的数据域。
一个M阶B+树每个节点拥有M个数据域，M个指针域。数据域存储的是数据的拷贝，每个指针域指向结构包含的数据都大于或者小于对应的数据域。所有的数据都集中在叶子节点，并且叶子节点之间由双向链表链接。
若假定层级为H，B+树最多可以存放M*M^(H-1)个元素，而B树可以存放M^(H-1)-1(等比数列算的)个元素，B+树存放的元素要比B树多；那么相反相同数量的情况下，B+树要比B树更加矮胖。

## 什么是索引的最左匹配原则？

答：
要先了解一下联合索引。联合索引即用多个字段共同组织的索，其排序规则由字段联合的顺序决定。例如：联合索引(a, b, c)中，数据的组织顺序先按照a排序，当a相等时，按照b排序，ab都相等时，按照c排序。
最左匹配原则是指，在数据域执行查询匹配索引时，只要查询语句中涉及联合索引最左侧的字段，那么就会命中索引，直到遇到范围查询(>、<、between、like)就停止匹配(这里注意是停止匹配后续而不是放弃使用索引)。

## 什么是覆盖索引？

答：
覆盖索引是一种数据查询方式，不是索引类型。叫索引覆盖似乎更恰当。
先说一下MySQL使用索引查询时的步骤。MySQL会先通过索引取得所查询行的主键ID，然后根据主键ID去主键索引(也就是聚集索引，是索引也是数据的存储)中取得整行数据的内容。
覆盖索引是指当SELECT语句查询的列都在所匹配的索引中有存储时，便不会再通过主键索引回表查询。

## 索引失效的场景？

答：

  1. OR连接的多个字段中存在无索引字段
  2. LIKE 匹配的字符串以%开头
  3. 需要隐式类型转换，例如：使用数字类型查询字符串类型，数据库会自动做转换
  4. 索引列参与了运算(也包含使用函数)
  5. 联合索引未使用最左侧字段
  6. 数据库自己认为扫全表更快

## MySQL事务的隔离级别

### 1. 事务的基本要素(ACID)

#### (1). 原子性(Atomicity)

​事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。

#### (2). 一致性(Consistency)

​事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。

#### (3). 隔离性(Isolation)

​同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。

#### (4). 持久性(Durability)

​事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。 

### 2. 事务的并发问题

#### (1). 脏读

​事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据

#### (2). 不可重复读

​事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果不一致。

#### (3). 幻读

​同样的条件，第1次和第2次读出来的**==记录数==**不一样。

​事务A首先根据条件索引得到N条数据，然后事务B改变了这N条数据之外的M条或者增添了M条符合事务A搜索条件的数据，导致事务A再次搜索发现有N+M条数据了，就产生了幻读。

　　**小结：不可重复读的和幻读很容易混淆，不可重复读侧重于修改，幻读侧重于新增或删除。解决不可重复读的问题只需锁住满足条件的行，解决幻读需要锁表**

### 3. MySQL事务隔离级别

| 事务隔离级别                 | 脏读 | 不可重复读 | 幻读 |
| -------------------------- | ---- | -------- | --- |
| 读未提交(read-uncommitted)  | 是   | 是        | 是  |
| 不可重复读(read-committed)  | 否    | 是       | 是   |
| 可重复读(repeatable-read)   | 否   | 否        | 是  |
| 串行化(serializable)       | 否    | 否        | 否  |
